name: CI (Release PRs)

# This workflow handles release PRs that have [skip ci] in their commits
# It uses pull_request_target which is NOT affected by [skip ci] in PR commits

on:
    pull_request_target:
        branches:
            - main
            - develop
        types: [opened, synchronize, reopened]

jobs:
    # Check if this is a release PR (has chore(release) in title or commits have [skip ci])
    check-release-pr:
        name: Check Release PR
        runs-on: ubuntu-latest
        outputs:
            is_release_pr: ${{ steps.check.outputs.is_release }}
        steps:
            - name: Check if release PR
              id: check
              run: |
                  if [[ "${{ github.event.pull_request.title }}" == chore\(release\)* ]] || \
                     [[ "${{ github.event.pull_request.title }}" == *"[skip ci]"* ]]; then
                    echo "is_release=true" >> $GITHUB_OUTPUT
                    echo "This is a release PR - will auto-pass checks"
                  else
                    echo "is_release=false" >> $GITHUB_OUTPUT
                    echo "Not a release PR - skipping"
                  fi

    # These jobs provide passing statuses for required checks on release PRs
    lint-and-type-check:
        name: Lint & Type Check
        runs-on: ubuntu-latest
        needs: check-release-pr
        if: needs.check-release-pr.outputs.is_release_pr == 'true'
        steps:
            - name: Auto-pass for release PR
              run: echo "Auto-passing Lint & Type Check for release PR"

    test:
        name: Unit Tests
        runs-on: ubuntu-latest
        needs: check-release-pr
        if: needs.check-release-pr.outputs.is_release_pr == 'true'
        steps:
            - name: Auto-pass for release PR
              run: echo "Auto-passing Unit Tests for release PR"

    build:
        name: Build Extension
        runs-on: ubuntu-latest
        needs: check-release-pr
        if: needs.check-release-pr.outputs.is_release_pr == 'true'
        steps:
            - name: Auto-pass for release PR
              run: echo "Auto-passing Build Extension for release PR"

    test-e2e:
        name: E2E Tests
        runs-on: ubuntu-latest
        needs: check-release-pr
        if: needs.check-release-pr.outputs.is_release_pr == 'true'
        steps:
            - name: Auto-pass for release PR
              run: echo "Auto-passing E2E Tests for release PR"
